(function(){var t,e,i;(function(n){function r(t,e){return b.call(t,e)}function a(t,e){var i,n,r,a,s,o,c,u,l,h,p=e&&e.split("/"),f=y.map,d=f&&f["*"]||{};if(t&&"."===t.charAt(0))if(e){for(p=p.slice(0,p.length-1),t=p.concat(t.split("/")),u=0;t.length>u;u+=1)if(h=t[u],"."===h)t.splice(u,1),u-=1;else if(".."===h){if(1===u&&(".."===t[2]||".."===t[0]))break;u>0&&(t.splice(u-1,2),u-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((p||d)&&f){for(i=t.split("/"),u=i.length;u>0;u-=1){if(n=i.slice(0,u).join("/"),p)for(l=p.length;l>0;l-=1)if(r=f[p.slice(0,l).join("/")],r&&(r=r[n])){a=r,s=u;break}if(a)break;!o&&d&&d[n]&&(o=d[n],c=u)}!a&&o&&(a=o,s=c),a&&(i.splice(0,s,a),t=i.join("/"))}return t}function s(t,e){return function(){return f.apply(n,x.call(arguments,0).concat([t,e]))}}function o(t){return function(e){return a(e,t)}}function c(t){return function(e){m[t]=e}}function u(t){if(r(g,t)){var e=g[t];delete g[t],w[t]=!0,p.apply(n,e)}if(!r(m,t)&&!r(w,t))throw Error("No "+t);return m[t]}function l(t){var e,i=t?t.indexOf("!"):-1;return i>-1&&(e=t.substring(0,i),t=t.substring(i+1,t.length)),[e,t]}function h(t){return function(){return y&&y.config&&y.config[t]||{}}}var p,f,d,v,m={},g={},y={},w={},b=Object.prototype.hasOwnProperty,x=[].slice;d=function(t,e){var i,n=l(t),r=n[0];return t=n[1],r&&(r=a(r,e),i=u(r)),r?t=i&&i.normalize?i.normalize(t,o(e)):a(t,e):(t=a(t,e),n=l(t),r=n[0],t=n[1],r&&(i=u(r))),{f:r?r+"!"+t:t,n:t,pr:r,p:i}},v={require:function(t){return s(t)},exports:function(t){var e=m[t];return e!==void 0?e:m[t]={}},module:function(t){return{id:t,uri:"",exports:m[t],config:h(t)}}},p=function(t,e,i,a){var o,l,h,p,f,y,b=[];if(a=a||t,"function"==typeof i){for(e=!e.length&&i.length?["require","exports","module"]:e,f=0;e.length>f;f+=1)if(p=d(e[f],a),l=p.f,"require"===l)b[f]=v.require(t);else if("exports"===l)b[f]=v.exports(t),y=!0;else if("module"===l)o=b[f]=v.module(t);else if(r(m,l)||r(g,l)||r(w,l))b[f]=u(l);else{if(!p.p)throw Error(t+" missing "+l);p.p.load(p.n,s(a,!0),c(l),{}),b[f]=m[l]}h=i.apply(m[t],b),t&&(o&&o.exports!==n&&o.exports!==m[t]?m[t]=o.exports:h===n&&y||(m[t]=h))}else t&&(m[t]=i)},t=e=f=function(t,e,i,r,a){return"string"==typeof t?v[t]?v[t](e):u(d(t,e).f):(t.splice||(y=t,e.splice?(t=e,e=i,i=null):t=n),e=e||function(){},"function"==typeof i&&(i=r,r=a),r?p(n,t,e,i):setTimeout(function(){p(n,t,e,i)},4),f)},f.config=function(t){return y=t,y.deps&&f(y.deps,y.callback),f},i=function(t,e,i){e.splice||(i=e,e=[]),r(m,t)||r(g,t)||(g[t]=[t,e,i])},i.amd={jQuery:!0}})(),i("lib/almond/almond",function(){}),function(t,e){"object"==typeof exports?module.exports=e():"function"==typeof i&&i.amd&&i("core/core",e)}(this,function(){var t=function(t){return"number"!=typeof t?t:this.isInt(t)?t:parseFloat(t.toFixed(2))},e=function(t){return 0===t%1},i=function(t,e,i){var n,r=Number(t),a=Number(e),s=Number(i);return s=Math.max(0,Math.min(1,s)),n=r+s*(a-r),isNaN(n),n},n=function(t,e){return{vx:t,vy:e}},r=function(t,e){var i=t?90*t+90:!1,n=e?90*e+180:!1;return this.getVector(i,n)},a=function(t){for(var e,i=0,n=0,r=Object.keys(t),a=r.length,s=0;a>s;s++)if(e=r[s],t[e])switch(e){case"up":n++;break;case"down":n--;break;case"right":i--;break;case"left":i++}return this.getAngle(i,n)},s=function(t,e){return Math.floor(Math.random()*(e-t+1))+t},o=function(){this.offset=100,this.buffersize=120,this.smoothing=20},c=function(t,e){var i=parseInt(t.state.private.x),n=parseInt(t.state.private.y),r=parseInt(e.state.private.x),a=parseInt(e.state.private.y);return r+e.width>=i&&i+t.width>=r&&a+e.height>=n&&n+t.height>=a},u=function(){},l=function(t){return t.time>Date.now()-1e3};return{lerp:i,getVector:n,getAngle:r,getVelocity:a,getRandomNumber:s,initGlobalVariables:o,isCollision:c,loadScene:u,filterQueue:l,toFixed:t,isInt:e}}),function(t,e){"function"==typeof i&&i.amd&&i("client/input",e)}(this,function(){var t={},e=[],i="38,38,40,40,37,39,37,39,66,65",n={32:"spacebar",37:"left",39:"right",65:"left",68:"right",87:"up",83:"down",38:"up",40:"down"},r=function(r){var a=r.keyCode;"keydown"===r.type&&(e=e.slice(-10),e.push(a),0===(""+e).indexOf(i)&&document.dispatchEvent(new CustomEvent("konami"))),82===a&&r.ctrlKey&&"keydown"===r.type&&$("#stats").toggle(),n[a]&&(r.preventDefault(),t[n[a]]="keydown"===r.type?!0:!1)},a=function(){window.addEventListener("keyup",r),window.addEventListener("keydown",r)};return{init:a,pressed:t}}),function(t,e){"function"==typeof i&&i.amd&&i("client/ui",e)}(this,function(){var t=function(){var t=function(){var t=Raphael("countdown",115,115),e=Raphael("countdown_static",115,115);return t.customAttributes.arc=e.customAttributes.arc=function(t,e,i,n,r){var a,s=360/n*i,o=(90-s)*Math.PI/180,c=t+r*Math.cos(o),u=e-r*Math.sin(o);return a=n==i?[["M",t,e-r],["A",r,r,0,1,1,t-.01,e-r]]:[["M",t,e-r],["A",r,r,0,+(s>180),1,c,u]],{path:a}},this.path=t.path().attr({stroke:"#ed1b24","stroke-width":10,arc:[60,60,0,100,50]}),e.path().attr({stroke:"#ccc","stroke-width":10,arc:[60,60,100,100,50]}),this},e=function(t){this.path.animate({arc:[60,60,t,100,50]},1e3)};return{init:t,animate:e}}(),e=function(e){return $(".countdown").on("click",function(){var t=e.entities[e.uuid];this.gameover(e,t)}.bind(this)),{clock:t.init()}},i=function(t,e){t.disconnect();var i,n,r;e&&(i=new Date(e.timer.now),n=i.getSeconds(),r=i.getMinutes()+":"+(10>n?"0"+n:n)),$(".gameover .time .clock").text(r),$(".gameover").fadeIn(function(){$("#main").hide(),$("#hud").hide(),$("header").remove();var t=e.state.public.src;$(".gameover .pic").css("background-image","url(../"+t+")"),$(".gameover ."+e.intoxicationLevel()).show();var i=encodeURIComponent("I "+e.intoxicationLevel(!0)+" at #beercamp! http://2013.beercamp.com via @nclud"),n=encodeURIComponent("http://2013.beercamp.com"),r="https://twitter.com/intent/tweet?original_referer="+n+" &text="+i;$(".tweet").attr("href",r).attr("target","_blank");var a="https://www.facebook.com/sharer/sharer.php?u=http://2013.beercamp.com";$(".facebook").attr("href",a).attr("target","_blank")})},n=function(t){t&&(s(t),$("#user").removeClass("sober tipsy buzzed schwasted").addClass(t.intoxicationLevel()))},r=function(){var t=function(t){var e=$("#queue");e.find(".number").text(t),e.show()},e=function(t){$("#queue").find(".number").text(t)},i=function(){$("#queue").fadeOut()};return{enter:t,update:e,exit:i}}(),a=function(t){if(t){for(var e=t.state.public.beer,i=8;i>e;i--)$('.weapon[data-count="'+i+'"]').removeClass("added");for(var n=1;e>=n&&8>=n;n++)$('.weapon[data-count="'+n+'"]').addClass("added")}},s=function(t){if(!$("#user").hasClass("user-face")){var e=t.state.public.src,i="";switch(e){case"images/char1.png":i="beardo";break;case"images/char2.png":i="mohawk";break;case"images/char3.png":i="glasses";break;case"images/char4.png":i="psy";break;default:i="floyd"}$("#user").addClass("user-face").addClass(i)}};return{init:e,gameover:i,updateFace:n,queue:r,setPlayerIcon:s,updateAmmo:a}}),function(t,e){"object"==typeof exports?module.exports=e():"function"==typeof i&&i.amd&&i("core/time",e)}(this,function(){var t=function(){this.now=Date.now(),this.delta=(this.now-this.then)/1e3,this.then=this.now};return{then:Date.now(),setDelta:t}}),function(t,e){"object"==typeof exports?module.exports=e():"function"==typeof i&&i.amd&&i("core/types/Actor",e)}(this,function(){var t=function(t,e,i,n){i.direction&&t.set({direction:i.direction}),this.entity=t,this.skin=document.createElement("canvas");var r;if(window.addEventListener("resize",function(){var t=function(){clearTimeout(r),this.updateCache(e,i,n.canvas);var t=0,a=this.entity.state.public.intoxication;a&&(t=Math.min(Math.floor(a/25),4)),this.drawFrame(t,n.canvas.scale)}.bind(this);r=setTimeout(t,100)}.bind(this)),this.updateCache(e,i,n.canvas),i){this.xMax=i.x,this.yMax=i.y,this.step=i.step,this.t=0;var a=this.map=i.map;this.sprite=a[0]}return this};return t.prototype.constructor=t,t.prototype.updateCache=function(t,e,i){var n=this.skin.getContext("2d"),r=i.scale,a=this.skin.dpr=window.devicePixelRatio;this.skin.width=e.width*r*a,this.skin.height=e.height*r*a,this.skin.scale=e.scale;var s=this.cached=this.renderToCanvas(t,e,r,!1),o=e.direction;if(o){this[o]=s;var c="right"===o?"left":"right";this[c]=this.renderToCanvas(t,e,r,!0)}n.drawImage(s,0,0)},t.prototype.renderToCanvas=function(t,e,i,n){var r=document.createElement("canvas"),a=r.getContext("2d"),s=t.width/t.height,o=this.skin.dpr,c=r.width=0|e.width*e.scale*s*i*o+.5,u=r.height=0|e.height*e.scale*i*o+.5;return n&&(a.translate(c,0),a.scale(-1,1)),a.drawImage(t,0,0,c,u),r},t.prototype.setFrame=function(t,e){this.entity.state.public,this.frame=t;var i=this.skin,n=i.getContext("2d"),r=this.cached,a=this.frame*r.width/this.xMax,s=e*r.height/this.yMax;n.clearRect(0,0,i.width,i.height),n.drawImage(r,-a,-s)},t.prototype.drawFrame=function(t){var e,i,n,r,a=this.entity.state.public,s=this.step,o=this.skin,c=o.getContext("2d"),u=this.cached;switch(c.clearRect(0,0,o.width,o.height),a.direction){case"right":n=this.sprite.start,r=this.t/s;break;case"left":n=this.xMax-this.sprite.end,r=-this.t/s}this.frame=n+r,e=this.frame*u.width/this.xMax,i=t*u.height/this.yMax,c.drawImage(u,-e,-i)},t.prototype.update=function(t,e){var i=this.entity.state.public,n=this.skin;this.cached,n.getContext("2d");var r=this.step,a=this.sprite.start+this.t/r>this.sprite.end?!0:!1;a?this.sprite.repeat?this.t=0:this.direction!==i.direction&&(this.direction=i.direction,this.drawFrame(t,e)):(0===this.t%r&&this.drawFrame(t,e),this.t++)},t.prototype.draw=function(t,e,i,n){var r=this.entity.state.public,a=this.skin.dpr,s=0|this.skin.width/a+.5,o=0|this.skin.height/a+.5,c=0|this.skin.width/a/2+.5,u=0|this.skin.height/a/2+.5,l=0,h=r.intoxication;h&&(l=Math.min(Math.floor(h/25),4));var p;switch(r.isBlackout||h>=100?(this.sprite=this.map[0],p="default"):r.isHit?(this.sprite=this.map[4],p="isHit"):r.isThrowing?(this.sprite=this.map[3],p="isThrowing"):r.isJumping?(this.sprite=this.map[2],p="isJumping"):r.isMoving?(this.sprite=this.map[1],p="isMoving"):(this.sprite=this.map[0],p="default"),this.animation!==p&&(this.animation=p,this.t=0),r.direction){case"right":this.cached=this.right,this.sprite.start===this.sprite.end&&this.frame!==this.sprite.start?this.setFrame(this.sprite.start,l,n):this.sprite.start!==this.sprite.end&&this.update(l,n);break;case"left":this.cached=this.left,this.sprite.start===this.sprite.end&&this.frame!==this.xMax-this.sprite.start-1?this.setFrame(this.xMax-this.sprite.start-1,l,n):this.sprite.start!==this.sprite.end&&this.update(l,n)}"Player"===this.entity.state.private.class?t.drawImage(this.skin,e-c,0|i-1.1*u+.5,s,o):t.drawImage(this.skin,e-c,i-u,s,o)},t}),function(t,e){"object"==typeof exports?module.exports=e():"function"==typeof i&&i.amd&&i("core/types/Graphic",e)}(this,function(){var t=function(t,e,i){this.entity=t,this.skin=document.createElement("canvas");var n;return window.addEventListener("resize",function(){var t=function(){clearTimeout(n),this.updateCache(e,i.canvas)}.bind(this);n=setTimeout(t,100)}.bind(this)),this.updateCache(e,i.canvas),this};return t.prototype.constructor=t,t.prototype.updateCache=function(t,e){var i=this.entity.state.private,n=this.skin.getContext("2d"),r=e.scale,a=t.height/t.width;this.skin.width=i.width*r,this.skin.height=i.width*a*r;var s=this.cached=this.renderToCanvas(t,r,!1);n.drawImage(s,0,0,s.width/2,s.height/2)},t.prototype.renderToCanvas=function(t,e){var i=this.entity.state.private,n=document.createElement("canvas"),r=n.getContext("2d"),a=t.height/t.width,s=n.width=2*i.width*e,o=n.height=2*i.width*a*e;return r.drawImage(t,0,0,s,o),n},t.prototype.draw=function(t,e,i){t.drawImage(this.skin,e,i)},t}),function(){var t=this,e=t._,i={},n=Array.prototype,r=Object.prototype,a=Function.prototype,s=n.push,o=n.slice,c=n.concat,u=r.toString,l=r.hasOwnProperty,h=n.forEach,p=n.map,f=n.reduce,d=n.reduceRight,v=n.filter,m=n.every,g=n.some,y=n.indexOf,w=n.lastIndexOf,b=Array.isArray,x=Object.keys,k=a.bind,T=function(t){return t instanceof T?t:this instanceof T?(this._wrapped=t,void 0):new T(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=T),exports._=T):t._=T,T.VERSION="1.4.4";var j=T.each=T.forEach=function(t,e,n){if(null!=t)if(h&&t.forEach===h)t.forEach(e,n);else if(t.length===+t.length){for(var r=0,a=t.length;a>r;r++)if(e.call(n,t[r],r,t)===i)return}else for(var s in t)if(T.has(t,s)&&e.call(n,t[s],s,t)===i)return};T.map=T.collect=function(t,e,i){var n=[];return null==t?n:p&&t.map===p?t.map(e,i):(j(t,function(t,r,a){n[n.length]=e.call(i,t,r,a)}),n)};var E="Reduce of empty array with no initial value";T.reduce=T.foldl=T.inject=function(t,e,i,n){var r=arguments.length>2;if(null==t&&(t=[]),f&&t.reduce===f)return n&&(e=T.bind(e,n)),r?t.reduce(e,i):t.reduce(e);if(j(t,function(t,a,s){r?i=e.call(n,i,t,a,s):(i=t,r=!0)}),!r)throw new TypeError(E);return i},T.reduceRight=T.foldr=function(t,e,i,n){var r=arguments.length>2;if(null==t&&(t=[]),d&&t.reduceRight===d)return n&&(e=T.bind(e,n)),r?t.reduceRight(e,i):t.reduceRight(e);var a=t.length;if(a!==+a){var s=T.keys(t);a=s.length}if(j(t,function(o,c,u){c=s?s[--a]:--a,r?i=e.call(n,i,t[c],c,u):(i=t[c],r=!0)}),!r)throw new TypeError(E);return i},T.find=T.detect=function(t,e,i){var n;return M(t,function(t,r,a){return e.call(i,t,r,a)?(n=t,!0):void 0}),n},T.filter=T.select=function(t,e,i){var n=[];return null==t?n:v&&t.filter===v?t.filter(e,i):(j(t,function(t,r,a){e.call(i,t,r,a)&&(n[n.length]=t)}),n)},T.reject=function(t,e,i){return T.filter(t,function(t,n,r){return!e.call(i,t,n,r)},i)},T.every=T.all=function(t,e,n){e||(e=T.identity);var r=!0;return null==t?r:m&&t.every===m?t.every(e,n):(j(t,function(t,a,s){return(r=r&&e.call(n,t,a,s))?void 0:i}),!!r)};var M=T.some=T.any=function(t,e,n){e||(e=T.identity);var r=!1;return null==t?r:g&&t.some===g?t.some(e,n):(j(t,function(t,a,s){return r||(r=e.call(n,t,a,s))?i:void 0}),!!r)};T.contains=T.include=function(t,e){return null==t?!1:y&&t.indexOf===y?-1!=t.indexOf(e):M(t,function(t){return t===e})},T.invoke=function(t,e){var i=o.call(arguments,2),n=T.isFunction(e);return T.map(t,function(t){return(n?e:t[e]).apply(t,i)})},T.pluck=function(t,e){return T.map(t,function(t){return t[e]})},T.where=function(t,e,i){return T.isEmpty(e)?i?null:[]:T[i?"find":"filter"](t,function(t){for(var i in e)if(e[i]!==t[i])return!1;return!0})},T.findWhere=function(t,e){return T.where(t,e,!0)},T.max=function(t,e,i){if(!e&&T.isArray(t)&&t[0]===+t[0]&&65535>t.length)return Math.max.apply(Math,t);if(!e&&T.isEmpty(t))return-1/0;var n={computed:-1/0,value:-1/0};return j(t,function(t,r,a){var s=e?e.call(i,t,r,a):t;s>=n.computed&&(n={value:t,computed:s})}),n.value},T.min=function(t,e,i){if(!e&&T.isArray(t)&&t[0]===+t[0]&&65535>t.length)return Math.min.apply(Math,t);if(!e&&T.isEmpty(t))return 1/0;var n={computed:1/0,value:1/0};return j(t,function(t,r,a){var s=e?e.call(i,t,r,a):t;n.computed>s&&(n={value:t,computed:s})}),n.value},T.shuffle=function(t){var e,i=0,n=[];return j(t,function(t){e=T.random(i++),n[i-1]=n[e],n[e]=t}),n};var P=function(t){return T.isFunction(t)?t:function(e){return e[t]}};T.sortBy=function(t,e,i){var n=P(e);return T.pluck(T.map(t,function(t,e,r){return{value:t,index:e,criteria:n.call(i,t,e,r)}}).sort(function(t,e){var i=t.criteria,n=e.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(n>i||void 0===n)return-1}return t.index<e.index?-1:1}),"value")};var C=function(t,e,i,n){var r={},a=P(e||T.identity);return j(t,function(e,s){var o=a.call(i,e,s,t);n(r,o,e)}),r};T.groupBy=function(t,e,i){return C(t,e,i,function(t,e,i){(T.has(t,e)?t[e]:t[e]=[]).push(i)})},T.countBy=function(t,e,i){return C(t,e,i,function(t,e){T.has(t,e)||(t[e]=0),t[e]++})},T.sortedIndex=function(t,e,i,n){i=null==i?T.identity:P(i);for(var r=i.call(n,e),a=0,s=t.length;s>a;){var o=a+s>>>1;r>i.call(n,t[o])?a=o+1:s=o}return a},T.toArray=function(t){return t?T.isArray(t)?o.call(t):t.length===+t.length?T.map(t,T.identity):T.values(t):[]},T.size=function(t){return null==t?0:t.length===+t.length?t.length:T.keys(t).length},T.first=T.head=T.take=function(t,e,i){return null==t?void 0:null==e||i?t[0]:o.call(t,0,e)},T.initial=function(t,e,i){return o.call(t,0,t.length-(null==e||i?1:e))},T.last=function(t,e,i){return null==t?void 0:null==e||i?t[t.length-1]:o.call(t,Math.max(t.length-e,0))},T.rest=T.tail=T.drop=function(t,e,i){return o.call(t,null==e||i?1:e)},T.compact=function(t){return T.filter(t,T.identity)};var I=function(t,e,i){return j(t,function(t){T.isArray(t)?e?s.apply(i,t):I(t,e,i):i.push(t)}),i};T.flatten=function(t,e){return I(t,e,[])},T.without=function(t){return T.difference(t,o.call(arguments,1))},T.uniq=T.unique=function(t,e,i,n){T.isFunction(e)&&(n=i,i=e,e=!1);var r=i?T.map(t,i,n):t,a=[],s=[];return j(r,function(i,n){(e?n&&s[s.length-1]===i:T.contains(s,i))||(s.push(i),a.push(t[n]))}),a},T.union=function(){return T.uniq(c.apply(n,arguments))},T.intersection=function(t){var e=o.call(arguments,1);return T.filter(T.uniq(t),function(t){return T.every(e,function(e){return T.indexOf(e,t)>=0})})},T.difference=function(t){var e=c.apply(n,o.call(arguments,1));return T.filter(t,function(t){return!T.contains(e,t)})},T.zip=function(){for(var t=o.call(arguments),e=T.max(T.pluck(t,"length")),i=Array(e),n=0;e>n;n++)i[n]=T.pluck(t,""+n);return i},T.object=function(t,e){if(null==t)return{};for(var i={},n=0,r=t.length;r>n;n++)e?i[t[n]]=e[n]:i[t[n][0]]=t[n][1];return i},T.indexOf=function(t,e,i){if(null==t)return-1;var n=0,r=t.length;if(i){if("number"!=typeof i)return n=T.sortedIndex(t,e),t[n]===e?n:-1;n=0>i?Math.max(0,r+i):i}if(y&&t.indexOf===y)return t.indexOf(e,i);for(;r>n;n++)if(t[n]===e)return n;return-1},T.lastIndexOf=function(t,e,i){if(null==t)return-1;var n=null!=i;if(w&&t.lastIndexOf===w)return n?t.lastIndexOf(e,i):t.lastIndexOf(e);for(var r=n?i:t.length;r--;)if(t[r]===e)return r;return-1},T.range=function(t,e,i){1>=arguments.length&&(e=t||0,t=0),i=arguments[2]||1;for(var n=Math.max(Math.ceil((e-t)/i),0),r=0,a=Array(n);n>r;)a[r++]=t,t+=i;return a},T.bind=function(t,e){if(t.bind===k&&k)return k.apply(t,o.call(arguments,1));var i=o.call(arguments,2);return function(){return t.apply(e,i.concat(o.call(arguments)))}},T.partial=function(t){var e=o.call(arguments,1);return function(){return t.apply(this,e.concat(o.call(arguments)))}},T.bindAll=function(t){var e=o.call(arguments,1);return 0===e.length&&(e=T.functions(t)),j(e,function(e){t[e]=T.bind(t[e],t)}),t},T.memoize=function(t,e){var i={};return e||(e=T.identity),function(){var n=e.apply(this,arguments);return T.has(i,n)?i[n]:i[n]=t.apply(this,arguments)}},T.delay=function(t,e){var i=o.call(arguments,2);return setTimeout(function(){return t.apply(null,i)},e)},T.defer=function(t){return T.delay.apply(T,[t,1].concat(o.call(arguments,1)))},T.throttle=function(t,e){var i,n,r,a,s=0,o=function(){s=new Date,r=null,a=t.apply(i,n)};return function(){var c=new Date,u=e-(c-s);return i=this,n=arguments,0>=u?(clearTimeout(r),r=null,s=c,a=t.apply(i,n)):r||(r=setTimeout(o,u)),a}},T.debounce=function(t,e,i){var n,r;return function(){var a=this,s=arguments,o=function(){n=null,i||(r=t.apply(a,s))},c=i&&!n;return clearTimeout(n),n=setTimeout(o,e),c&&(r=t.apply(a,s)),r}},T.once=function(t){var e,i=!1;return function(){return i?e:(i=!0,e=t.apply(this,arguments),t=null,e)}},T.wrap=function(t,e){return function(){var i=[t];return s.apply(i,arguments),e.apply(this,i)}},T.compose=function(){var t=arguments;return function(){for(var e=arguments,i=t.length-1;i>=0;i--)e=[t[i].apply(this,e)];return e[0]}},T.after=function(t,e){return 0>=t?e():function(){return 1>--t?e.apply(this,arguments):void 0}},T.keys=x||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var i in t)T.has(t,i)&&(e[e.length]=i);return e},T.values=function(t){var e=[];for(var i in t)T.has(t,i)&&e.push(t[i]);return e},T.pairs=function(t){var e=[];for(var i in t)T.has(t,i)&&e.push([i,t[i]]);return e},T.invert=function(t){var e={};for(var i in t)T.has(t,i)&&(e[t[i]]=i);return e},T.functions=T.methods=function(t){var e=[];for(var i in t)T.isFunction(t[i])&&e.push(i);return e.sort()},T.extend=function(t){return j(o.call(arguments,1),function(e){if(e)for(var i in e)t[i]=e[i]}),t},T.pick=function(t){var e={},i=c.apply(n,o.call(arguments,1));return j(i,function(i){i in t&&(e[i]=t[i])}),e},T.omit=function(t){var e={},i=c.apply(n,o.call(arguments,1));for(var r in t)T.contains(i,r)||(e[r]=t[r]);return e},T.defaults=function(t){return j(o.call(arguments,1),function(e){if(e)for(var i in e)null==t[i]&&(t[i]=e[i])}),t},T.clone=function(t){return T.isObject(t)?T.isArray(t)?t.slice():T.extend({},t):t},T.tap=function(t,e){return e(t),t};var A=function(t,e,i,n){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;t instanceof T&&(t=t._wrapped),e instanceof T&&(e=e._wrapped);var r=u.call(t);if(r!=u.call(e))return!1;switch(r){case"[object String]":return t==e+"";case"[object Number]":return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object RegExp]":return t.source==e.source&&t.global==e.global&&t.multiline==e.multiline&&t.ignoreCase==e.ignoreCase}if("object"!=typeof t||"object"!=typeof e)return!1;for(var a=i.length;a--;)if(i[a]==t)return n[a]==e;i.push(t),n.push(e);var s=0,o=!0;if("[object Array]"==r){if(s=t.length,o=s==e.length)for(;s--&&(o=A(t[s],e[s],i,n)););}else{var c=t.constructor,l=e.constructor;if(c!==l&&!(T.isFunction(c)&&c instanceof c&&T.isFunction(l)&&l instanceof l))return!1;for(var h in t)if(T.has(t,h)&&(s++,!(o=T.has(e,h)&&A(t[h],e[h],i,n))))break;if(o){for(h in e)if(T.has(e,h)&&!s--)break;o=!s}}return i.pop(),n.pop(),o};T.isEqual=function(t,e){return A(t,e,[],[])},T.isEmpty=function(t){if(null==t)return!0;if(T.isArray(t)||T.isString(t))return 0===t.length;for(var e in t)if(T.has(t,e))return!1;return!0},T.isElement=function(t){return!(!t||1!==t.nodeType)},T.isArray=b||function(t){return"[object Array]"==u.call(t)},T.isObject=function(t){return t===Object(t)},j(["Arguments","Function","String","Number","Date","RegExp"],function(t){T["is"+t]=function(e){return u.call(e)=="[object "+t+"]"}}),T.isArguments(arguments)||(T.isArguments=function(t){return!(!t||!T.has(t,"callee"))}),true&&(T.isFunction=function(t){return"function"==typeof t}),T.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},T.isNaN=function(t){return T.isNumber(t)&&t!=+t},T.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"==u.call(t)},T.isNull=function(t){return null===t},T.isUndefined=function(t){return void 0===t},T.has=function(t,e){return l.call(t,e)},T.noConflict=function(){return t._=e,this},T.identity=function(t){return t},T.times=function(t,e,i){for(var n=Array(t),r=0;t>r;r++)n[r]=e.call(i,r);return n},T.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))};var R={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};R.unescape=T.invert(R.escape);var _={escape:RegExp("["+T.keys(R.escape).join("")+"]","g"),unescape:RegExp("("+T.keys(R.unescape).join("|")+")","g")};T.each(["escape","unescape"],function(t){T[t]=function(e){return null==e?"":(""+e).replace(_[t],function(e){return R[t][e]})}}),T.result=function(t,e){if(null==t)return null;var i=t[e];return T.isFunction(i)?i.call(t):i},T.mixin=function(t){j(T.functions(t),function(e){var i=T[e]=t[e];T.prototype[e]=function(){var t=[this._wrapped];return s.apply(t,arguments),B.call(this,i.apply(T,t))}})};var q=0;T.uniqueId=function(t){var e=++q+"";return t?t+e:e},T.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var S=/(.)^/,F={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},O=/\\|'|\r|\n|\t|\u2028|\u2029/g;T.template=function(t,e,i){var n;i=T.defaults({},i,T.templateSettings);var r=RegExp([(i.escape||S).source,(i.interpolate||S).source,(i.evaluate||S).source].join("|")+"|$","g"),a=0,s="__p+='";t.replace(r,function(e,i,n,r,o){return s+=t.slice(a,o).replace(O,function(t){return"\\"+F[t]}),i&&(s+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'"),n&&(s+="'+\n((__t=("+n+"))==null?'':__t)+\n'"),r&&(s+="';\n"+r+"\n__p+='"),a=o+e.length,e}),s+="';\n",i.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{n=Function(i.variable||"obj","_",s)}catch(o){throw o.source=s,o}if(e)return n(e,T);var c=function(t){return n.call(this,t,T)};return c.source="function("+(i.variable||"obj")+"){\n"+s+"}",c},T.chain=function(t){return T(t).chain()};var B=function(t){return this._chain?T(t).chain():t};T.mixin(T),j(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=n[t];T.prototype[t]=function(){var i=this._wrapped;return e.apply(i,arguments),"shift"!=t&&"splice"!=t||0!==i.length||delete i[0],B.call(this,i)}}),j(["concat","join","slice"],function(t){var e=n[t];T.prototype[t]=function(){return B.call(this,e.apply(this._wrapped,arguments))}}),T.extend(T.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),i("underscore",function(t){return function(){var e;return e||t._}}(this)),function(t,n){"object"==typeof exports?module.exports=n(e("../core"),e("../time"),void 0,void 0,e("underscore"),e("idgen")):"function"==typeof i&&i.amd&&i("core/types/Entity",["../core","../time","./Actor","./Graphic","underscore"],n)}(this,function(t,e,i,n,r,a){var s=function(t,e,i){return a?this.uuid=a(4):e&&(this.uuid=e),this.state={},this.state.private={},this.state.public={},t&&(this.set(t),this.createActor(i)),this.set({isNew:!0}),this.queue={},this.queue.server=[],this};return s.prototype.createActor=function(t){var e=this.state.private;i&&e.sprite&&e.img?this.actor=new i(this,e.img,e.sprite,t):n&&e.img&&(this.actor=new n(this,e.img,t))},s.prototype.needsImage=function(){return this.state.private.src?!0:!1},s.prototype.createImage=function(t){var e=this.state.private,i=new Image,n=this;(function(t,e,r){i.addEventListener("load",function(){t.img=this,n.createActor(r)})})(e,e.uuid,t),i.src=e.src},s.prototype.set=function(t){for(var e in t)this.state.private[e]=t[e],this.state.public[e]=t[e]},s.prototype.setPublic=function(t){for(var e in t)this.state.public[e]=t[e];this.updatePositionAndVelocity()},s.prototype.updatePositionAndVelocity=function(){this.state.public.x=t.toFixed(this.state.public.x),this.state.public.y=t.toFixed(this.state.public.y),this.state.public.velocity&&(this.state.public.velocity.x=t.toFixed(this.state.public.velocity.x),this.state.public.velocity.y=t.toFixed(this.state.public.velocity.y))},s.prototype.shouldRenderAs=function(t){return this.state.private.class===t},s.prototype.serialize=function(){var t=this.state.public;return Object.keys(t).length?(t.t=t.class,t):void 0},s.prototype.getState=function(){return Object.keys(this.state.public).length?{state:this.state.public,time:Date.now()}:void 0},s.prototype.canEverMove=function(){return!0},s.prototype.class=function(){return this.state.private["class"]},s.prototype.getDelta=function(t,e){for(var i,n=this.state.private,r=this.state.private=e.clone(this.state.public),a=[],s=Object.keys(r),o=s.length,c=0;o>c;c++)i=s[c],n[i]!==r[i]&&("object"==typeof n[i]&&e.isEqual(n[i],r[i])||a.push(i));if(a.length){var u=e.pick(r,a);return u}},s.prototype.interpolate=function(){var i=Math.abs(this.state.public.x-this.state.private.x),n=Math.abs(this.state.public.y-this.state.private.y),r=Math.max(i,n);if(this.queue.server.length&&!(.1>r)){for(var a,s,o,c,u=this.queue.server.length-1,l=0;u>l&&(o=this.queue.server[l],c=this.queue.server[l+1],!(e.client>o.time&&e.client<c.time));l++);if(o){var h=0,r=o.time-e.client,p=o.time-e.server;h=r/p,a=t.lerp(o.state.x,this.state.public.x,h),s=t.lerp(o.state.y,this.state.public.y,h),this.state.private.x=10>i?t.lerp(this.state.private.x,a,e.delta*t.smoothing):t.lerp(o.state.x,a,e.delta*t.smoothing),this.state.private.y=10>n?t.lerp(this.state.private.y,s,e.delta*t.smoothing):t.lerp(o.state.y,s,e.delta*t.smoothing)}else this.state.private.x=this.state.public.x,this.state.private.y=this.state.public.y}},s.prototype.draw=function(t,e){t.save();var i=0|this.state.private.x*e+.5,n=0|this.state.private.y*e+.5;0|this.state.private.width*e/2+.5,0|this.state.private.height*e/2+.5,t.translate(i,n),t.rotate(this.state.public.rotation),t.scale(this.state.public.scale,this.state.public.scale),t.translate(-i,-n),this.drawType&&this.drawType(t,e),t.restore()},s}),function(t,n){"object"==typeof exports?module.exports=n(e("../core"),e("../time"),e("./Entity")):"function"==typeof i&&i.amd&&i("core/types/Rectangle",["../core","../time","./Entity"],n)}(this,function(t,e,i){var n=function(t,e,n){return t=t||{},t.class=t.class||"Rectangle",t.type=t.type||"static",i.call(this,t,e,n),this};return n.prototype=new i,n.prototype.constructor=n,n.prototype.drawType=function(t,e){var i=0|this.state.private.x*e+.5,n=0|this.state.private.y*e+.5,r=0|this.state.private.width*e+.5,a=0|this.state.private.height*e+.5,s=0|this.state.private.width*e/2+.5,o=0|this.state.private.height*e/2+.5;t.save(),t.lineWidth=2,t.strokeStyle="salmon",t.strokeRect(i-s,n-o,r,a),t.restore()},n}),function(t,n){"object"==typeof exports?module.exports=n(e("../core"),e("../time"),e("./Rectangle")):"function"==typeof i&&i.amd&&i("core/types/Background",["../core","../time","./Rectangle"],n)}(this,function(t,e,i){var n=function(t,e,n){return t=t||{},t.class=t.class||"Background",i.call(this,t,e,n),this};return n.prototype=new i,n.prototype.constructor=n,n.prototype.canEverMove=function(){return!1},n.prototype.drawType=function(t,e){var i=0|this.state.private.x*e+.5,n=0|this.state.private.y*e+.5;0|this.state.private.width*e+.5,0|this.state.private.height*e+.5;var r=0|this.state.private.width*e/2+.5,a=0|this.state.private.height*e/2+.5;t.save(),this.actor&&this.actor.draw(t,i-r,n-a,e),t.restore()},n}),function(t,n){"object"==typeof exports?module.exports=n(e("../core"),e("../time"),e("./Rectangle")):"function"==typeof i&&i.amd&&i("core/types/Platform",["../core","../time","./Rectangle"],n)}(this,function(t,e,i){var n=function(t,e,n){return t=t||{},t.class=t.class||"Platform",t.sprite=t.sprite||{src:"images/level_sprite.png",width:t.width,height:t.width,x:10,y:10,scale:4,map:{0:{start:1,end:1,repeat:!1}}},i.call(this,t,e,n),this};return n.prototype=new i,n.prototype.constructor=n,n.prototype.canEverMove=function(){return!1},n.prototype.drawType=function(t,e){var i=0|this.state.private.x*e+.5,n=0|this.state.private.y*e+.5,r=0|this.state.private.width*e+.5,a=0|this.state.private.height*e+.5,s=0|this.state.private.width*e/2+.5,o=0|this.state.private.height*e/2+.5;t.save();var c,u,l,h=this.state.private.color?this.state.private.color.light:"#bcbdc0",p=this.state.private.color?this.state.private.color.dark:"#a7a9ab";switch(this.state.private.perspective){case"left":c=i-s,u=n-o,l=s,t.fillStyle=h,t.beginPath(),t.moveTo(c,u-l),t.lineTo(c+s,u-l),t.lineTo(c+s,u+a+l),t.lineTo(c,u+a+l),t.closePath(),t.fill(),c+=s,t.fillStyle=p,t.beginPath(),t.moveTo(c,u-l),t.lineTo(c+s,u),t.lineTo(c+s,u+a),t.lineTo(c,u+a+l),t.closePath(),t.fill();break;case"right":c=i-s,u=n-o,l=s,t.fillStyle=p,t.beginPath(),t.moveTo(c,u),t.lineTo(c+s,u-l),t.lineTo(c+s,u+a+l),t.lineTo(c,u+a),t.closePath(),t.fill(),c+=s,t.fillStyle=h,t.beginPath(),t.moveTo(c,u-l),t.lineTo(c+s,u-l),t.lineTo(c+s,u+a+l),t.lineTo(c,u+a+l),t.closePath(),t.fill();break;default:c=i-s,u=n,l=a,t.shadowOffsetX=0,t.shadowOffsetY=o/2,t.shadowBlur=a,t.shadowColor="black",t.beginPath(),t.moveTo(c-l,u),t.lineTo(c+l+r,u),t.lineTo(c+l+r,u+o),t.lineTo(c-l,u+o),t.closePath(),t.fill(),t.shadowColor="none",t.fillStyle=h,t.beginPath(),t.lineCap="round",t.moveTo(c-l-o,u),t.lineTo(c+l+r+o,u),t.lineTo(c+l+r+o,u+o),t.lineTo(c-l-o,u+o),t.closePath(),t.fill(),u-=o,t.fillStyle=p,t.beginPath(),t.moveTo(c-l,u),t.lineTo(c+l+r,u),t.lineTo(c+l+r+o,u+o),t.lineTo(c-l-o,u+o),t.closePath(),t.fill()}t.restore()},n}),function(t,n){"object"==typeof exports?module.exports=n(e("../core"),e("../time"),e("./Rectangle")):"function"==typeof i&&i.amd&&i("core/types/Powerup",["../core","../time","./Rectangle"],n)
}(this,function(t,e,i){var n=function(t,e,n){return t=t||{},t.class=t.class||"Powerup",t.type=t.type||"static",t.angle=t.angle||0,t.width=t.width||2,t.height=t.height||1.2,t.fixed=t.fixed||!0,t.isSensor=t.isSensor||!0,i.call(this,t,e,n),this};return n.prototype=new i,n.prototype.constructor=n,n.prototype.drawType=function(t,e){var i=0|this.state.private.x*e+.5,n=0|this.state.private.y*e+.5;0|this.state.private.width*e+.5,0|this.state.private.height*e+.5,0|this.state.private.width*e/2+.5;var r=0|this.state.private.height*e/2+.5;t.save(),this.actor&&this.actor.draw(t,i,n+.6*r,e),t.restore()},n}),function(t,n){"object"==typeof exports?module.exports=n(e("../core"),e("../time"),e("./Rectangle")):"function"==typeof i&&i.amd&&i("core/types/Projectile",["../core","../time","./Rectangle"],n)}(this,function(t,e,i){var n=function(t,e,n){return t=t||{},t.class=t.class||"Projectile",t.type=t.type||"dynamic",t.angle=t.angle||0,t.width=t.width||2,t.height=t.height||1.2,t.fixed=t.fixed||!1,t.isSensor=t.isSensor||!0,t.speed=t.speed||30,t.src=t.src||"images/beer.png",t.sprite=t.sprite||{src:t.src,direction:t.direction,width:2,height:2,x:2,y:1,scale:.6,map:{0:{start:0,end:0},1:{start:1,end:1}}},i.call(this,t,e,n),this};return n.prototype=new i,n.prototype.constructor=n,n.prototype.drawType=function(t,e){var i=0|this.state.private.x*e+.5,n=0|this.state.private.y*e+.5;0|this.state.private.width*e+.5,0|this.state.private.height*e+.5,0|this.state.private.width*e/2+.5;var r=0|this.state.private.height*e/2+.5;t.save(),this.actor&&this.actor.draw(t,i,n+.6*r,e),t.restore()},n}),function(t,n){"object"==typeof exports?module.exports=n(e("../core"),e("../time"),e("./Entity"),e("./Rectangle"),e("./Projectile"),e("underscore"),e("../../server/entities")):"function"==typeof i&&i.amd&&i("core/types/Player",["../core","../time","./Entity","./Rectangle","./Projectile","underscore"],n)}(this,function(t,e,i,n,r,a,s){var o=function(t,e,i){t=t||{},t.name=t.name||this.defaultNameFor(t.src),t.name.length>10&&(t.name=t.name.substring(0,10)),t.class=t.class||"Player",t.type=t.type||"dynamic",t.angle=t.angle||0,t.width=t.width||2.5,t.height=t.height||3,t.fixed=t.fixed||!0,t.speed=t.speed||230,t.gravity=t.gravity||50,t.sprite=t.sprite||{direction:"right",width:4,height:4,x:9,y:5,step:8,scale:5,map:{0:{start:0,end:0,repeat:!1},1:{start:1,end:3,repeat:!0},2:{start:4,end:5,repeat:!1},3:{start:6,end:7,repeat:!1},4:{start:8,end:8,repeat:!1}}},t.beer=0,t.intoxication=5,n.call(this,t,e,i),this.seq=0,this.queue.input=[],this.input={};var r=Date.now(),a=r+12e4;return this.timer={start:r,stop:a,now:Date.now()-r,update:function(){return this.now=Date.now()-this.start,100*this.now/(this.stop-this.start)}},this};return o.prototype=new n,o.prototype.constructor=o,o.prototype.drink=function(){this.state.public.beer++,this.state.public.intoxication+=5},o.prototype.defaultNameFor=function(t){return"images/char1.png"===t?"Mike":"images/char2.png"===t?"Jeff":"images/char3.png"===t?"Tanya":"images/char4.png"===t?"KSnug":"images/char5.png"===t?"Floyd":void 0},o.prototype.setPublic=function(t){t=a.defaults(t,{velocity:t.v}),t.ix&&!t.intoxication&&(t.intoxication=t.ix),t.h&&!t.isHit&&(t.isHit=t.h),t.j&&!t.isJumping&&(t.isJumping=t.j),t.mv&&!t.isMoving&&(t.isMoving=t.mv),t.d&&!t.direction&&(t.direction=t.d),i.prototype.setPublic.call(this,t)},o.prototype.serialize=function(){return this.optimizeSerializedAttributes(this.state.public)},o.prototype.optimizeSerializedAttributes=function(t){var e=a.omit(t,"class","type","angle","width","height","sprite","fixed","speed","velocity","intoxication","isHit","isJumping","isMoving","direction");return e.v=t.velocity,e.t="Player",e.ix=t.intoxication?t.intoxication:void 0,e.h=a.isUndefined(t.isHit)?void 0:t.isHit,e.j=a.isUndefined(t.isJumping)?void 0:t.isJumping,e.mv=a.isUndefined(t.isMoving)?void 0:t.isMoving,e.d=a.isUndefined(t.direction)?void 0:t.direction,e},o.prototype.fire=function(t){if(this.state.public.beer&&(this.state.public.beer--,this.setPublic({isThrowing:!0}),this.throwTimeout&&clearTimeout(this.throwTimeout),this.throwTimeout=setTimeout(function(){this.setPublic({isThrowing:!1})}.bind(this),600),t)){var e=this.state.public.x,i=this.state.public.y,n=new r({x:e,y:i,direction:this.state.public.direction});s.global[n.uuid]=n,s.local.push(n.uuid);var a={"class":n.state.private.class,type:n.state.private.type,x:n.state.private.x,y:n.state.private.y,angle:n.state.private.angle,width:n.state.private.width,height:n.state.private.height,direction:n.state.private.direction,speed:n.state.private.speed,src:n.state.private.src,isSensor:n.state.private.isSensor};t.send({cmd:"fire",uuid:n.uuid,entity:a,owner:this.uuid})}},o.prototype.hit=function(){this.setPublic({isHit:!0,intoxication:Math.max(this.state.public.intoxication-5,5)}),this.hitTimeout&&clearTimeout(this.hitTimeout),this.hitTimeout=setTimeout(function(){this.setPublic({isHit:!1})}.bind(this),500)},o.prototype.sendImpulse=function(t,e){t.send({cmd:"impulse",uuid:this.uuid,degrees:e,power:this.state.private.speed})},o.prototype.respondToInput=function(e,i){if(!this.gameover){if(this.state.public.isBlackout)return this.gameover=!0,void 0;var n,r=[];for(var a in e)e[a]!==this.input[a]&&(r.push(a),this.input[a]=e[a]);t.getVelocity(e);for(var s,o=r.length,c=0;o>c;c++)switch(s=r[c]){case"up":e.up&&!this.state.public.isJumping&&(this.state.public.isJumping=!0);break;case"left":case"right":e.left!==e.right?(this.state.public.isMoving=!0,this.state.public.direction=e.left?"left":"right"):this.state.public.isMoving=!1;break;case"spacebar":e.spacebar?this.fire():this.fireButtonReleased=!0}r.length&&(n={seq:this.seq++,input:e},this.queue.input.push(n),"function"==typeof i&&i(n))}},o.prototype.processInput=function(e,i){process.nextTick(function(){if(!this.end){if(this.state.public.isBlackout)return i.send({cmd:"setZero",uuid:this.uuid}),this.end=!0,void 0;var n=e.input,r=[];for(var a in n)n[a]!==this.input[a]&&(r.push(a),this.input[a]=n[a]);for(var s,o=t.getVelocity(n),c=r.length,u=0;c>u;u++)switch(s=r[u]){case"up":n.up&&!this.state.public.isJumping&&(this.state.public.isJumping=!0,this.sendImpulse(i,o.vy));break;case"left":case"right":!n.left==!n.right?(this.state.public.isMoving=!1,i.send({cmd:"setZero",uuid:this.uuid})):(this.state.public.isMoving=!0,this.state.public.direction=n.left?"left":"right",this.sendImpulse(i,o.vx));break;case"spacebar":n.spacebar?this.fire(i):this.fireButtonReleased=!0}this.queue.input.length&&this.processInput(this.queue.input.shift(),i)}}.bind(this))},o.prototype.reconcile=function(i,n){for(var r,a,s=0,o=0,c=this.queue.input=this.queue.input.filter(function(t){return t.seq>this.ack}.bind(this)),u=0;c.length>u;u++)s+=parseInt(c[u].data.speed*c[u].data.vector.dx*e.delta),o+=parseInt(c[u].data.speed*c[u].data.vector.dy*e.delta);r=parseInt(n.ship.state.x)+s,a=parseInt(n.ship.state.y)+o,this.state.private.x=t.lerp(this.state.private.x,r,e.delta*t.smoothing),this.state.private.y=t.lerp(this.state.private.y,a,e.delta*t.smoothing)},o.prototype.drawType=function(t,e){var i=this.x(e),n=this.y(e);t.save(),this.actor&&this.actor.draw(t,i,n,e),t.restore(),this.drawName(t,e,this.state.public.name)},o.prototype.drawName=function(t,e,i){var n=this.x(e),r=this.y(e),a=this.halfHeight(e);t.save();var s=Math.max(14,parseInt(e));t.font=s+"px Monstrrr-Serif",t.textAlign="center",t.fillStyle="white",t.shadowOffsetX=2,t.shadowOffsetY=2,t.shadowColor="black",t.fillText(i,n,r-a-s/2),t.restore()},o.prototype.halfHeight=function(t){return 0|this.state.private.height*t/2+.5},o.prototype.halfWidth=function(t){return 0|this.state.private.width*t/2+.5},o.prototype.height=function(t){return 0|this.state.private.height*t+.5},o.prototype.width=function(t){return 0|this.state.private.height*t+.5},o.prototype.x=function(t){return 0|this.state.private.x*t+.5},o.prototype.y=function(t){return 0|this.state.private.y*t+.5},o.prototype.intoxicationLevel=function(t){var e=this.state.public.intoxication;return 25>e?t?"was stone cold sober":"sober":e>=25&&50>e?t?"got slightly tipsy":"tipsy":e>=50&&75>e?t?"got righteously buzzed":"buzzed":e>=75&&100>e?t?"got sooper dooper schwasted":"schwasted":t?"mutha-f-ing blacked out":"blackout"},o}),function(t,n){"object"==typeof exports?module.exports=n(e("../core"),e("../time"),e("./Powerup"),e("underscore")):"function"==typeof i&&i.amd&&i("core/types/Beer",["../core","../time","./Powerup","underscore"],n)}(this,function(t,e,i,n){var r=function(t,e,r){return t.class="Powerup",n.defaults(t,{src:"images/beer.png",sprite:{direction:"right",width:2,height:2,x:2,y:1,scale:.6,map:{0:{start:0,end:0},1:{start:1,end:1}}}}),i.call(this,t,e,r),this};return r.prototype=new i,r.prototype.constructor=r,r.prototype.serialize=function(){var t=n.pick(this.state.public,"x","y");return t.t="Beer",t},r.prototype.shouldRenderAs=function(t){return"Powerup"===t},r.spawnRandom=function(){var t=[12,19,26,33,40,46,53,60],e=Math.floor(Math.random()*t.length),i={x:44*Math.random()+1,y:t[e]};return new r(i)},r}),function(t,n){"object"==typeof exports?module.exports=n(e):"function"==typeof i&&i.amd&&i("core/types",["require","./types/Entity","./types/Rectangle","./types/Background","./types/Graphic","./types/Platform","./types/Powerup","./types/Projectile","./types/Player","./types/Beer","./types/Actor"],n)}(this,function(t){return{Entity:t("./types/Entity"),Rectangle:t("./types/Rectangle"),Background:t("./types/Background"),Graphic:t("./types/Graphic"),Platform:t("./types/Platform"),Powerup:t("./types/Powerup"),Projectile:t("./types/Projectile"),Player:t("./types/Player"),Beer:t("./types/Beer"),Actor:t("./types/Actor")}});var n=function(){var t=Date.now(),e=t,i=0,n=1/0,r=0,a=0,s=1/0,o=0,c=0,u=0,l=document.createElement("div");l.id="stats",l.addEventListener("mousedown",function(t){t.preventDefault(),y(++u%2)},!1),l.style.cssText="width:80px;opacity:0.9;cursor:pointer";var h=document.createElement("div");h.id="fps",h.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002",l.appendChild(h);var p=document.createElement("div");p.id="fpsText",p.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",p.innerHTML="FPS",h.appendChild(p);var f=document.createElement("div");for(f.id="fpsGraph",f.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff",h.appendChild(f);74>f.children.length;){var d=document.createElement("span");d.style.cssText="width:1px;height:30px;float:left;background-color:#113",f.appendChild(d)}var v=document.createElement("div");v.id="ms",v.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none",l.appendChild(v);var m=document.createElement("div");m.id="msText",m.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",m.innerHTML="MS",v.appendChild(m);var g=document.createElement("div");for(g.id="msGraph",g.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0",v.appendChild(g);74>g.children.length;)d=document.createElement("span"),d.style.cssText="width:1px;height:30px;float:left;background-color:#131",g.appendChild(d);var y=function(t){switch(u=t){case 0:h.style.display="block",v.style.display="none";break;case 1:h.style.display="none",v.style.display="block"}};return{REVISION:11,domElement:l,setMode:y,begin:function(){t=Date.now()},end:function(){var u=Date.now();i=u-t,n=Math.min(n,i),r=Math.max(r,i),m.textContent=i+" MS ("+n+"-"+r+")";var l=Math.min(30,30-30*(i/200));return g.appendChild(g.firstChild).style.height=l+"px",c++,u>e+1e3&&(a=Math.round(1e3*c/(u-e)),s=Math.min(s,a),o=Math.max(o,a),p.textContent=a+" FPS ("+s+"-"+o+")",l=Math.min(30,30-30*(a/100)),f.appendChild(f.firstChild).style.height=l+"px",e=u,c=0),u},update:function(){t=this.end()}}};i("stats",function(t){return function(){var e;return e||t.Stats}}(this)),function(t,e){"function"==typeof i&&i.amd&&i("client/client",["../core/core","../core/time","../core/types","./input","./ui","stats"],e)}(this,function(t,e,i,r,a){var s=new n;document.body.appendChild(s.domElement);var o=[],c={},u=function(n){var r=a.init(n).clock;this.actions=[this.clearCanvas,this.updateEntities,this.drawEntities,this.updateCamera];var s=function(t){var e=t.detail,i=n.entities[n.uuid];if(i){if(i.gameover||n.konami)return;var s=Math.min(e.intoxication,100);s>=100&&(i.setPublic({isBlackout:!0}),a.gameover(n,i));var o=5*s-500;document.getElementById("beer").style.bottom=o+"px",a.updateFace(i),a.updateAmmo(i);var c=i.timer.update();r.animate(c),i.timer.now>i.timer.stop-i.timer.start&&(i.gameover=!0,a.gameover(n,i))}};document.addEventListener("hud",s),document.addEventListener("konami",function(){n.konami=!0}),setInterval(function(){j(n)},1e3);var o=this.socket=io.connect();o.on("game:load",function(){var t=l("as"),e=l("name");o.emit("player:select",{"character-id":t,name:e})}),o.on("queue:enter",function(t){a.queue.enter(t),o.on("queue:update",function(t){a.queue.update(t)}),o.on("queue:exit",function(){a.queue.exit()})}),o.on("uuid",function(t){n.uuid=t}),o.on("state:full",function(r){e.server=r.time,e.client=e.server-t.offset;for(var a,s,o,c=_.union(Object.keys(n.entities),Object.keys(r.entities)),u={},l=0;c.length>l;l++)a=c[l],s=r.entities[a],s&&n.entities[a]?(o=s,n.entities[a].setPublic(o),n.entities[a].queue.server.push(n.entities[a].getState())):s?(o=s,n.entities[a]=new i[o.t](o,a,n),n.entities[a].needsImage()&&n.entities[a].createImage(n),u[a]=o):n.entities[a].canEverMove()&&delete n.entities[a];Object.keys(u).length}),o.on("state:delta",function(r){e.server=r.time,e.client=e.server-t.offset;for(var a,s,o,c=Object.keys(r.entities),u=c.length,l=0;u>l;l++)a=c[l],s=r.entities[a],s&&n.entities[a]?(n.entities[a].setPublic(s),n.entities[a].queue.server.push(n.entities[a].getState()),n.entities[a].queue.server=n.entities[a].queue.server.filter(t.filterQueue)):s&&(o=s,o.t&&i[o.t]&&(n.entities[a]=new i[o.t](o,a,n),n.entities[a].needsImage()&&n.entities[a].createImage(n)))})},l=function(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e="[\\?&]"+t+"=([^&#]*)",i=RegExp(e),n=i.exec(window.location.search);return null==n?"":decodeURIComponent(n[1].replace(/\+/g," "))},h=function(){p(this)},p=function(t){var t=t||this;t.animationFrame=window.requestAnimationFrame(h.bind(t)),e.setDelta(),v(t),s.update()},f=function(){window.cancelAnimationFrame(this.animationFrame),this.areRunning=!1},d=function(){this.areRunning||(this.then=Date.now(),this.loop(),this.areRunning=!0)},v=function(t){for(var e=0;t.actions.length>e;e++)t.actions[e](t)},m=function(t){t.ctx.clearRect(0,0,t.canvas.width,t.canvas.height)},g=function(){var t=64,e=window.innerHeight-t;return e},y=function(){var t=this.canvas=document.createElement("canvas");this.ctx=t.ctx=t.getContext("2d"),this.setScale(t,window.innerWidth);var e=this.camera=document.createElement("canvas");e.ctx=e.getContext("2d"),this.setScale(e,window.innerWidth,this.cameraHeight());var i;window.addEventListener("resize",function(){var t=function(){clearTimeout(i);var t=window.innerWidth,e=this.cameraHeight();this.setScale(this.canvas,t),this.setScale(this.camera,t,e),this.updateCamera(this)}.bind(this);i=setTimeout(t,100)}.bind(this)),document.getElementById("main").appendChild(e)},w=function(t,e,i){var n=120,r=120,a=e-n-r;t.scale=a/48,t.width=a,t.height=i||62*t.scale},b=function(t){for(var e,i,n=Object.keys(t.entities),a=n.length,s=0;a>s;s++)e=n[s],i=t.entities[e],interpolate=e!==t.uuid,interpolate?i.interpolate():(i.interpolate(),i.respondToInput(r.pressed,function(e){t.socket.emit("command:send",e)}))},x=function(t){for(var e,i,n=["Background","Platform","Powerup","Projectile","Player"],r=n.length,a=Object.keys(t.entities),s=a.length,o=0;r>o;o++)for(var c=0;s>c;c++)e=a[c],i=t.entities[e],!i.state.public.isDead&&i.shouldRenderAs(n[o])&&i.draw(t.ctx,t.canvas.scale)},k=function(t){var e,i=t.camera.ctx,n=t.canvas,r=t.entities[t.uuid];r&&(e=Math.min(r.state.private.y*n.scale,n.height-g()/2),i.clearRect(0,0,window.innerWidth,window.innerHeight),i.drawImage(n,0,g()/2-e))},T=function(){var t=this.entities[this.uuid];return t?t:void 0},j=function(t){var e=t.entities[t.uuid];if(e){var i=e.state.public,n=new CustomEvent("hud",{detail:{intoxication:i.intoxication}});document.dispatchEvent(n)}},E=function(){console.log("Game over! Thanks for playing."),this.socket.disconnect()};return{actions:o,entities:c,getParameter:l,init:u,loop:p,pause:f,play:d,runFrameActions:v,clearCanvas:m,createCanvas:y,setScale:w,updateEntities:b,drawEntities:x,updateCamera:k,cameraHeight:g,currentPlayer:T,disconnect:E}}),function(t,e){"function"==typeof i&&i.amd&&i("client/init",["../core/core","./input","./ui","./client","underscore"],e)}(this,function(t,e,i,n){t.initGlobalVariables(),e.init(),n.createCanvas(),n.init(n),n.play()}),e(["client/init"])})();